<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/1.3.5/css/lightgallery.min.css">
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/1.3.5/js/lightgallery.min.js"></script>
<script type='text/javascript'>
  //<![CDATA[

  // RSS feed option examples 
  // https://ourmooseinabox.blogspot.com/feeds/posts/default/-/sabbatical?start-index=10&max-results=10
  // ?alt=rss
  // ?start-index=1
  // ?max-results=10
  // ?q=australia
  // ?q=craft%20beer     phrase?
  // ?q=australia+cats    two search terms?
  // ?published-min=2014-12-01T00:00:00 (published-min, published-max, updated-min, updated-max)
  // /-/sabbatical   = Label
  // /-/label1/label2  = 2 Labels

  function subDisplay(name) {
    $("#" + name).show();
  }

  function hideAll() {
    $("#AllMyImages").children().hide();
  }

  //----------------------------

  var g_baseURL = "http://ourmooseinabox.blogspot.com/feeds/posts/default";
  var g_allBlogData = [];
  var g_imageCount = 0;
  var g_rssIndex = 1;
  
  //https://2.bp.blogspot.com/-h7XQTGAnOZU/WB3oWe9w5CI/AAAAAAAAF7c/kMq0yLSV2XUHoIuq4_CMxUoG7FI3l02RQCKgB/s320/IMG_20161023_173649.jpg
  function imgURLWithSize(orig, size)
  {
    if(orig.search("bp.blogspot.com") == -1)
    {
      return orig;
    }
    else if(/\/s\d*\//.test(orig))
    {
      var sizeStr = "/s" + size + "/"
      return orig.replace(/\/s\d*\//,sizeStr);
    }
    return orig
  }

  function printEntry(entry, myDiv) {
    var imageArray = entry["imageArray"];
    for (var j = 0; j < imageArray.length; j++) {
      var linkText = imageArray[j]["imageCaption"] + "<br />From blog post: <a target=\"_blank\" href=\"" + entry["postURL"]+ "\">"+ entry["postTitle"] + "</a>";
      
      
      var linkElem = document.createElement("a");
      linkElem.setAttribute("href",imgURLWithSize(imageArray[j]["imageURL"],400));
      linkElem.setAttribute("imageanchor",1);
      linkElem.setAttribute("class", "linksForGallery");
      linkElem.setAttribute("title", linkText);
      
      var imageText = imageArray[j]["imageCaption"];
      var elem = document.createElement("img");
      elem.setAttribute("src", imgURLWithSize(imageArray[j]["imageURL"],50));
      elem.setAttribute("width", "100");
      elem.setAttribute("alt", imageText);
      elem.setAttribute("title", imageText);
      elem.setAttribute("class", "imagesForGallery");
      linkElem.appendChild(elem);
      myDiv.appendChild(linkElem);
    }
  }

  function printBlogData(sortOrder) {
    var myDiv = document.getElementById("AllMyImages");
    while (myDiv.hasChildNodes()) {
      myDiv.removeChild(myDiv.lastChild);
    }

    if (sortOrder == "olderFirst") {
      for (var i = g_allBlogData.length - 1; i >= g_allBlogData.length-3; i--) {
        printEntry(g_allBlogData[i], myDiv);
      }
    } else {
      for (var i = 0; i < 1; i++) {
        printEntry(g_allBlogData[i], myDiv);
      }
    }

    var debug = "true";
    $(".linksForGallery").lightGallery();
  }

  function getCaption(imageNode) {
    var parentNode = imageNode.parent();
    if (parentNode[0].nodeName == "A") {
      return getCaption(parentNode);
    } else if (parentNode[0].nodeName == "TD") {
      return getCaption(parentNode);
    } else if (parentNode[0].nodeName == "TR") {
      var sibling = parentNode.next();
      return sibling.text();
    }

    return "";
  }

  function findAllImageData(html) {
    var myImageArray = []
    var imgs = $(html).find("img");
    if (imgs.length > 0) {
      imgs.each(function() {
        var im = $(this);
        var src = im.attr("src");
        var caption = getCaption(im);
        var imageData = [];
        imageData["imageURL"] = src;
        imageData["imageCaption"] = caption;
        myImageArray.push(imageData);
        g_imageCount++;
      });
    }
    return myImageArray;
  }

  function cat(json) {
    var label = json.feed.entry;
    var lst = [];
    for (i = 0; i < label.length; i++) {
      lst[i] = label[i].title.$t;
    }
  }

  function parseJSON(json) {
    var entries = json.feed.entry;
    if (entries == null) {
      console.log("entries: " + g_rssIndex);
      printBlogData("newerFirst");
      return;
    }
    for (i = 0; i < entries.length; i++) {
      var entry = entries[i];
      var myEntryArray = [];
      myEntryArray["postTitle"] = entry.title.$t;
      myEntryArray["postURL"] = entry.link.filter(function(a) {
        return a.rel == 'alternate'
      })[0].href;
      var htmlContent = entry.content.$t;
      myEntryArray["imageArray"] = findAllImageData(htmlContent);
      g_allBlogData.push(myEntryArray);
    }
    if (entries.length > 0) {
      g_rssIndex = g_rssIndex + entries.length;
      return loadImageDataWithIndexWithJSON();
    } else {
      console.log("entries: " + g_rssIndex);
      return;
    }
  }

  function loadImageDataWithIndexWithJSON() {
    var thisUrl = g_baseURL + "?start-index=" + g_rssIndex + "&alt=json";
    $.get(thisUrl, parseJSON);
  }

  function loadImageDataWithJson() {
    g_allBlogData = [];
    g_imageCount = 0;
    g_rssIndex = 1;
    loadImageDataWithIndexWithJSON();
  }

  //$.get("http://ourmooseinabox.blogspot.com/feeds/posts/default?alt=json&max-results=10",cat);

  //]]>
</script>

<style>

</style>

<a href="javascript:loadImageDataWithJson()">json</a>  | 
<a href="javascript:printBlogData(&quot;olderFirst&quot;)">printOlderFirst</a>  | 
<a href="javascript:printBlogData(&quot;newerFirst&quot;)">printNewerFirst</a>

<div id="AllMyImages">
</div>
